## Цель работы

В работе решается задача прогнозирования температуры сплава стали в конце технологического процесса выплавки стали. Актуальность задачи обусловлена тем, что в ходе выплавки периодически происходит нагрев расплава с последующим контролем химического состава, поэтому более раннее достижение целевой температуры снизит расход электроэнергии на металлургическом предприятии

## Показатели

В качестве целевой метрики в задаче используется MAE - Mean Absolute Error - среднее значение абсолютного отклонения величины. По условиям задачи и исходя из здравого смысла модель должна обеспечивать **MAE < 6,8°C**

## Исходные данные

Исходные данные, использовавшиеся при обучении, состояли из нескольких таблиц:
|Наименование таблицы|Описание|
|----|----|
| 'data_arc_new.csv'|Данные по включению нагревателей (время и мощность)|
|'data_bulk_new.csv'|Количественные данные по подаче сыпучих легирующих материалов|
| 'data_bulk_time_new.csv'|Временные метки по подаче сыпучих легирующих материалов|
|'data_gas_new.csv'|Данные по подаче газа продувки расплава|
|'data_temp_new.csv'|Результаты измерений температуры|
|'data_wire_new.csv'|Количественные данные по подаче легирующих материалов в виде проволоки|
|'data_wire_time_new.csv'| Временные метки по подаче легирующих материалов в виде проволоки|

Особенностью исходных данных явилось то, что часть таблиц содержали агрегированные по номеру образца (плавки) данные, а часть - данные для каждого образца по каждой временной метке. 

**В исходных данных содржалась информация максимум по 3214 уникальным образцам**

В ходе предварительного анализа данных было установлено:
- пропуски в данных есть только в таблицах по легирующим элементам и обусловлены тем, что какие-то элементы просто не добавляются.
- есть неадекватные значенияЖ отрицательная мощность и температура ниже 1500°C (технологически невозможно в данном случае)
- в разных таблицах разное количество уникальных номеров образцов


## Предобработка данных

Для подготовки данных к обучению моделей были выполнены следующие шаги:
- удалены образцы с аномальными значениями мощности и температуры
- удалены образцы, для которых количество измерений темературы не превышает 1 (поскольку конечная температура является предсказываемым значением)
- заполнены пропуски по легирующим элементам (значение 0)
- выполнена аггрегация таблицы с измерениями температуры по уникальному номеру образца: сформированы новые столбцы - начальная и конечная температура
- выполнена аггрегация таблицы с данными о нагревателях по уникальному номеру образца: сформированы новые столбцы - суммарные мощности, продолжительность нагрева, количество включений нагревателя, стандартное отклонение времени работы нагревателя
- объединение всех таблиц (тип inner) по уникальному номеру образца. Таким образом в финальный набор данных вошли только те образцы, по которым есть информация во всех таблицах
- в объединенной таблице абсолютное время добавления легирующего элемента было заменено на время от момента первого включения нагревателя
- были удалены неинформативные для машинного обучения столбцы - время первого включения нагреватея и номер образца
- выпонен анализ корреляции признаков. Сильно скоррелированные признаки были удалены, либо заменены на альтернатиные (мощность и время работы нагревателя заменены на затраченную энергию), также были удалены данные по легирующему элементу, который к рассматриваемым образцам не добавлялся (Wire 5)
- данные были поделены на выборки (тренировочную и тестовую), тестовая выборка составила 25% от всего набора данных
- были выделены целевое значение (конечная температура) и признаки
- признаки были отмасштабированы

**После предобработки осталось 2324 образца**

## Выбор модели машинного обучения

**В исследовательской части проекта были рассмотрены и использованием кросс-валидации (число блоков 10) модели**

- CatBoostRegressor
- LinearRegression
- LightGBMRegressor

**Наилучшие результаты по целевой метрике показала на кросс-валидации модель LightGBMRegressor со следующими гиперпараметрами**

|Параметр|Значение|
|---|---|
|learning_rate|0,05|
|n_estimators|150|
|num_leaves|10|

**При проверке на тестовой выборке и при сравнении рассмотренных моделей с константной моделью получены следующие результаты**

|Модель|MAE|
| ---| ---|
|CatBoost|6,82|
|LightGBM|**6,50**|
|Dummy Regressor (mean) |8,06|

**Наименьшее значение целевой метрики MAE обеспечивает модель LightGBM, при этом МАЕ не превышает требуемого значения - 6,8.
Также модель обеспечивает лучшее значение метрики по сравнению с константной моделью.**

**Топ-3 признаков по важности для предсказания**

- энергия, затраченная на нагрев
- начальная температура
- количество элемента Wire1 (вероятно, имеет температуру плавления, заметно отличающуюся от температуры плавления железа, что и приводит к его влиянию на конечную температуру)

## Деплой

Лучшая из выбранных моделей помещена в Docker-контейнер
Фронтенд реализован с использованием Streamlit

Модель функционирует следующим образом.
- на вход подаются подготовленные признаки (например, первые 10 строк из features_test) в формате csv. Признаков должно быть 47 (аналогично предобработке в данном исследовании)
- предсказания модели выводятся пользователю в виде таблицы


Структура репозитория
- app - папка с приложением и докер-файлом
- example.csv - пример файла признаков для проверки модели

**Клонирование репозитория**
```bash
git clone
```

**Сборка**
```bash
docker build --t metal .
```
**Запуск**
```bash
docker run --rm -it -p 8501:8501 --name LGBMContainer metal
```

После этого модель доступна по адресу 
```bash
localhost:8501/
```

## Вывод

**Разработана, протестирована и развернута модель, обеспечивающая предсказание конечной температуры сплавов стали со значением МАЕ не более 6,5**